const Format={UNKNOWN:0,A8:1,L8:2,LA8:3,R8:4,R8SN:5,R8UI:6,R8I:7,R16F:8,R16UI:9,R16I:10,R32F:11,R32UI:12,R32I:13,RG8:14,RG8SN:15,RG8UI:16,RG8I:17,RG16F:18,RG16UI:19,RG16I:20,RG32F:21,RG32UI:22,RG32I:23,RGB8:24,SRGB8:25,RGB8SN:26,RGB8UI:27,RGB8I:28,RGB16F:29,RGB16UI:30,RGB16I:31,RGB32F:32,RGB32UI:33,RGB32I:34,RGBA8:35,BGRA8:36,SRGB8_A8:37,RGBA8SN:38,RGBA8UI:39,RGBA8I:40,RGBA16F:41,RGBA16UI:42,RGBA16I:43,RGBA32F:44,RGBA32UI:45,RGBA32I:46,R5G6B5:47,R11G11B10F:48,RGB5A1:49,RGBA4:50,RGB10A2:51,RGB10A2UI:52,RGB9E5:53,DEPTH:54,DEPTH_STENCIL:55,BC1:56,BC1_ALPHA:57,BC1_SRGB:58,BC1_SRGB_ALPHA:59,BC2:60,BC2_SRGB:61,BC3:62,BC3_SRGB:63,BC4:64,BC4_SNORM:65,BC5:66,BC5_SNORM:67,BC6H_UF16:68,BC6H_SF16:69,BC7:70,BC7_SRGB:71,ETC_RGB8:72,ETC2_RGB8:73,ETC2_SRGB8:74,ETC2_RGB8_A1:75,ETC2_SRGB8_A1:76,ETC2_RGBA8:77,ETC2_SRGB8_A8:78,EAC_R11:79,EAC_R11SN:80,EAC_RG11:81,EAC_RG11SN:82,PVRTC_RGB2:83,PVRTC_RGBA2:84,PVRTC_RGB4:85,PVRTC_RGBA4:86,PVRTC2_2BPP:87,PVRTC2_4BPP:88,ASTC_RGBA_4X4:89,ASTC_RGBA_5X4:90,ASTC_RGBA_5X5:91,ASTC_RGBA_6X5:92,ASTC_RGBA_6X6:93,ASTC_RGBA_8X5:94,ASTC_RGBA_8X6:95,ASTC_RGBA_8X8:96,ASTC_RGBA_10X5:97,ASTC_RGBA_10X6:98,ASTC_RGBA_10X8:99,ASTC_RGBA_10X10:100,ASTC_RGBA_12X10:101,ASTC_RGBA_12X12:102,ASTC_SRGBA_4X4:103,ASTC_SRGBA_5X4:104,ASTC_SRGBA_5X5:105,ASTC_SRGBA_6X5:106,ASTC_SRGBA_6X6:107,ASTC_SRGBA_8X5:108,ASTC_SRGBA_8X6:109,ASTC_SRGBA_8X8:110,ASTC_SRGBA_10X5:111,ASTC_SRGBA_10X6:112,ASTC_SRGBA_10X8:113,ASTC_SRGBA_10X10:114,ASTC_SRGBA_12X10:115,ASTC_SRGBA_12X12:116,COUNT:117},COMPRESSED_RGBA_ASTC_4x4_KHR=37808,COMPRESSED_RGB_S3TC_DXT1_EXT=33776,COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,COMPRESSED_RGBA_BPTC_UNORM=36492,COMPRESSED_RGB_ETC1_WEBGL=36196,COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,GL_NEAREST=9728,GL_LINEAR=9729,GL_NEAREST_MIPMAP_NEAREST=9984,GL_LINEAR_MIPMAP_NEAREST=9985,GL_NEAREST_MIPMAP_LINEAR=9986,GL_LINEAR_MIPMAP_LINEAR=9987,GL_UNSIGNED_BYTE=5121,GL_UNSIGNED_SHORT=5123,GL_UNSIGNED_INT=5125,GL_FLOAT=5126,GL_UNSIGNED_SHORT_5_6_5=33635,GL_UNSIGNED_SHORT_4_4_4_4=32819,GL_UNSIGNED_SHORT_5_5_5_1=32820,GL_HALF_FLOAT_OES=36193,GL_DEPTH_COMPONENT=6402,GL_ALPHA=6406,GL_RGB=6407,GL_RGBA=6408,GL_LUMINANCE=6409,GL_LUMINANCE_ALPHA=6410,GL_COMPRESSED_RGB_S3TC_DXT1_EXT=33776,GL_COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,GL_COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,GL_COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,GL_COMPRESSED_RGB_ETC1_WEBGL=36196,GL_COMPRESSED_RGB8_ETC2=37492,GL_COMPRESSED_RGBA8_ETC2_EAC=37496,_filterGL=[[9728,9984,9986],[9729,9985,9987]],_textureFmtGL=[{format:6407,internalFormat:33776,pixelType:null},{format:6408,internalFormat:33777,pixelType:null},{format:6408,internalFormat:33778,pixelType:null},{format:6408,internalFormat:33779,pixelType:null},{format:6407,internalFormat:36196,pixelType:null},{format:6407,internalFormat:35841,pixelType:null},{format:6408,internalFormat:35843,pixelType:null},{format:6407,internalFormat:35840,pixelType:null},{format:6408,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6407,internalFormat:6407,pixelType:36193},{format:6408,internalFormat:6408,pixelType:36193},{format:6407,internalFormat:6407,pixelType:5126},{format:6408,internalFormat:6408,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:6407,internalFormat:37492,pixelType:null},{format:6408,internalFormat:37496,pixelType:null}];_textureFmtGL[Format.BC7]={format:Format.BC7,internalFormat:36492,pixelType:5121},_textureFmtGL[Format.BC1]={format:Format.BC1,internalFormat:33776,pixelType:null},_textureFmtGL[Format.BC3]={format:Format.BC3,internalFormat:33779,pixelType:null},_textureFmtGL[Format.ASTC_RGBA_4X4]={format:Format.ASTC_RGBA_4X4,internalFormat:37808,pixelType:null},_textureFmtGL[Format.ETC_RGB8]={format:Format.ETC_RGB8,internalFormat:36196,pixelType:null},_textureFmtGL[Format.PVRTC_RGB4]={format:Format.PVRTC_RGB4,internalFormat:35840,pixelType:null},_textureFmtGL[Format.PVRTC_RGBA4]={format:Format.PVRTC_RGBA4,internalFormat:35842,pixelType:null};const BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7:6,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFRGBA32:13,cTFRGB565:14,cTFRGBA4444:16,cTFPVRTC2_4_RGBA:19},enums={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6},BASIS_FORMAT_2_GL_FORMAT={[BASIS_FORMAT.cTFETC1]:Format.ETC_RGB8,[BASIS_FORMAT.cTFETC2]:Format.ETC2_RGB8,[BASIS_FORMAT.cTFBC1]:Format.BC1,[BASIS_FORMAT.cTFBC3]:Format.BC3,[BASIS_FORMAT.cTFBC4]:Format.BC4,[BASIS_FORMAT.cTFBC5]:Format.BC5,[BASIS_FORMAT.cTFBC7]:Format.BC7,[BASIS_FORMAT.cTFPVRTC1_4_RGB]:Format.PVRTC_RGB4,[BASIS_FORMAT.cTFPVRTC1_4_RGBA]:Format.PVRTC_RGBA4,[BASIS_FORMAT.cTFASTC_4x4]:Format.ASTC_RGBA_4X4,[BASIS_FORMAT.cTFRGBA32]:Format.RGBA32F,[BASIS_FORMAT.cTFRGB565]:Format.R5G6B5,[BASIS_FORMAT.cTFRGBA4444]:Format.RGBA16F,[BASIS_FORMAT.cTFPVRTC2_4_RGBA]:Format.PVRTC_RGBA4},glTextureFmt=function(_){let e=_textureFmtGL[_];return void 0===e?_textureFmtGL[enums.TEXTURE_FMT_RGBA8]:e},BasisFormat2GlFormat=function(_){return BASIS_FORMAT_2_GL_FORMAT[_]};async function start(){const _=await BASIS(),{BasisFile:e,initializeBasis:T}=_;T();const t=console.log;var R,a,r,A,o,E=function(_,e,T){cc.sys.capabilities.imageBitmap&&cc.macro.ALLOW_IMAGE_BITMAP?(e.responseType="blob",cc.assetManager.downloader.downloadFile(_,e,e.onFileProgress,T)):cc.assetManager.downloader.downloadDomImage(_,e,T)},B=function(_,e,T){if(window.CC_PREVIEW)return void E(_,e,T);let t=cc.path.changeExtname(_,".basis");e.responseType="arraybuffer",cc.assetManager.downloader.downloadFile(t,e,(t,R)=>{t?E(_,e,T):n(R,T)})};cc.assetManager.downloader.register({".png":B,".jpg":B}),function(){let _=null;function e(){var _=cc.game.canvas.getContext("webgl");R=!!_.getExtension("WEBGL_compressed_texture_astc"),a=!!_.getExtension("WEBGL_compressed_texture_etc1"),r=!!_.getExtension("WEBGL_compressed_texture_s3tc"),A=!!_.getExtension("WEBGL_compressed_texture_pvrtc")||!!_.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),o=!!_.getExtension("EXT_texture_compression_bptc")}if(cc.game.canvas)e();else{cc.game.once(cc.game.EVENT_GAME_INITED,e),_=document.createElement("canvas"),document.body.appendChild(_);var T=_.getContext("webgl");R=!!T.getExtension("WEBGL_compressed_texture_astc"),a=!!T.getExtension("WEBGL_compressed_texture_etc1"),r=!!T.getExtension("WEBGL_compressed_texture_s3tc"),A=!!T.getExtension("WEBGL_compressed_texture_pvrtc")||!!T.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),o=!!T.getExtension("EXT_texture_compression_bptc"),_.remove()}}(),Object.defineProperty(cc.Texture2D.prototype,"_nativeAsset",{set:function(_){_._compressed&&_._data?this.initWithData(_._data,_.format||this._format,_.width,_.height):this.initWithElement(_)},configurable:!0,enumerable:!0}),cc.renderer&&cc.renderer.Texture2D?cc.renderer.Texture2D.prototype._setMipmap=function(_,e,T){let t=glTextureFmt(this._format);this._format!=Format.BC7&&this._format!=Format.BC1&&this._format!=Format.BC3&&this._format!=Format.ASTC_RGBA_4X4||(this._compressed=!0);let R={width:this._width,height:this._height,flipY:e,premultiplyAlpha:T,level:0,image:null};for(let a=0;a<_.length;++a)R.level=a,R.width=this._width>>a,R.height=this._height>>a,R.image=_[a],this._setImage(t,R)}:cc.gfx&&cc.gfx.Texture2D&&(cc.gfx.Texture2D.prototype._setMipmap=function(_,e,T){let t=glTextureFmt(this._format);this._format!=Format.BC7&&this._format!=Format.BC1&&this._format!=Format.BC3&&this._format!=Format.ASTC_RGBA_4X4||(this._compressed=!0);let R={width:this._width,height:this._height,flipY:e,premultiplyAlpha:T,level:0,image:null};for(let a=0;a<_.length;++a)R.level=a,R.width=this._width>>a,R.height=this._height>>a,R.image=_[a],this._setImage(t,R)});var n=async function(T,E){performance.now();const B=new e(new Uint8Array(T));var n,l=B.getImageWidth(0,0),S=B.getImageHeight(0,0),C=B.getNumImages(),i=B.getNumLevels(0),G=B.getHasAlpha();if(l&&S&&C&&i||(console.warn("Invalid .basis file"),B.close(),B.delete()),R?n=BASIS_FORMAT.cTFASTC_4x4:o?n=BASIS_FORMAT.cTFBC7:r?n=G?BASIS_FORMAT.cTFBC3:BASIS_FORMAT.cTFBC1:A?(n=G?BASIS_FORMAT.cTFPVRTC1_4_RGBA:BASIS_FORMAT.cTFPVRTC1_4_RGB,0==(l&l-1)&&0==(S&S-1)||t("ERROR: PVRTC1 requires square power of 2 textures"),l!=S&&t("ERROR: PVRTC1 requires square power of 2 textures")):a?n=BASIS_FORMAT.cTFETC1:(n=BASIS_FORMAT.cTFRGB565,t("Decoding .basis data to 565")),!B.startTranscoding())return t("startTranscoding failed"),B.close(),void B.delete();_.formatIsUncompressed(n);const F=_.getBytesPerBlockOrPixel(n),m=B.getImageTranscodedSizeInBytes(0,0,n),s=new Uint8Array(m);if(!B.transcodeImage(s,0,0,n,0,0)){const e=0,R=0;var c=B.getFileDesc(),L=B.getImageDesc(e),I=B.getImageLevelDesc(e,R),N=!1;if(c.texFormat==_.basis_tex_format.cETC1S.value){const e=new _.LowLevelETC1SImageTranscoder;var P=new Uint8Array(T,c.selectorPaletteOfs,c.selectorPaletteLen),p=new Uint8Array(T,c.endpointPaletteOfs,c.endpointPaletteLen),O=new Uint8Array(T,c.tablesOfs,c.tablesLen),M=new Uint8Array(T,I.rgbFileOfs,I.rgbFileLen+I.alphaFileLen);if((N=e.decodePalettes(c.numEndpoints,p,c.numSelectors,P))?(N=e.decodeTables(O))?(N=e.transcodeImage(n,s,m/F,M,L.numBlocksX,L.numBlocksY,L.origWidth,L.origHeight,R,0,I.rgbFileLen,c.hasAlphaSlices?I.rgbFileLen:0,I.alphaFileLen,0,c.hasAlphaSlices,c.isVideo,0,0))||t("transcodeImage() failed"):t("decodeTables() failed"):t("decodePalettes() failed"),e.delete(),!N)return t("etc1s_transcoder failed"),console.warn("etc1s_transcoder failed"),B.close(),void B.delete();t("Successfully called etc1s_transcoder.transcodeImage()",N)}else{if(M=new Uint8Array(T,I.rgbFileOfs,I.rgbFileLen),!(N=_.transcodeUASTCImage(n,s,m/F,M,L.numBlocksX,L.numBlocksY,L.origWidth,L.origHeight,R,0,I.rgbFileLen,0,c.hasAlphaSlices,c.isVideo,0,0,-1,-1)))return t("transcodeUASTCImage() failed"),console.warn("transcodeUASTCImage() failed"),B.close(),void B.delete();t("Successfully called transcodeUASTCImage()",N)}}performance.now(),B.close(),B.delete();let u=null;u={_data:s,_compressed:!0,width:l+3&-4,height:S+3&-4,format:BasisFormat2GlFormat(n)},E&&E(null,u)}}start();